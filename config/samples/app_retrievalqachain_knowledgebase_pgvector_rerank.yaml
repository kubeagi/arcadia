apiVersion: arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: Application
metadata:
  name: base-chat-with-knowledgebase-pgvector-rerank
  namespace: arcadia
spec:
  displayName: "çŸ¥è¯†åº“åº”ç”¨"
  description: "æœ€ç®€å•çš„å’ŒçŸ¥è¯†åº“å¯¹è¯çš„åº”ç”¨"
  prologue: "Welcome to talk to the KnowledgeBase!ğŸ¤–"
  docNullReturn: "æœªæ‰¾åˆ°æ‚¨è¯¢é—®çš„å†…å®¹ï¼Œè¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¸ºæ‚¨æä¾›æ›´å¥½çš„æœåŠ¡"
  nodes:
    - name: Input
      displayName: "ç”¨æˆ·è¾“å…¥"
      description: "ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹ï¼Œå¿…é¡»"
      ref:
        kind: Input
        name: Input
      nextNodeName: ["prompt-node"]
    - name: prompt-node
      displayName: "prompt"
      description: "è®¾å®špromptï¼Œtemplateä¸­å¯ä»¥ä½¿ç”¨{{xx}}æ¥æ›¿æ¢å˜é‡"
      ref:
        apiGroup: prompt.arcadia.kubeagi.k8s.com.cn
        kind: Prompt
        name: base-chat-with-knowledgebase
      nextNodeName: ["chain-node"]
    - name: llm-node
      displayName: "zhipuå¤§æ¨¡å‹æœåŠ¡"
      description: "è®¾å®šå¤§æ¨¡å‹çš„è®¿é—®ä¿¡æ¯"
      ref:
        apiGroup: arcadia.kubeagi.k8s.com.cn
        kind: LLM
        name: app-shared-llm-service
      nextNodeName: ["chain-node"]
    - name: knowledgebase-node
      displayName: "ä½¿ç”¨çš„çŸ¥è¯†åº“"
      description: "è¦ç”¨å“ªä¸ªçŸ¥è¯†åº“"
      ref:
        apiGroup: arcadia.kubeagi.k8s.com.cn
        kind: KnowledgeBase
        name: knowledgebase-sample-pgvector
      nextNodeName: ["retriever-node"]
    - name: retriever-node
      displayName: "ä»çŸ¥è¯†åº“æå–ä¿¡æ¯çš„retriever"
      description: "è¿æ¥åº”ç”¨å’ŒçŸ¥è¯†åº“"
      ref:
        apiGroup: retriever.arcadia.kubeagi.k8s.com.cn
        kind: KnowledgeBaseRetriever
        name: base-chat-with-knowledgebase-pgvector-1
      nextNodeName: ["rerank-retriever-node"]
    - name: rerank-retriever-node
      displayName: "rerank retriever"
      description: "é‡æ’"
      ref:
        apiGroup: retriever.arcadia.kubeagi.k8s.com.cn
        kind: RerankRetriever
        name: base-chat-with-knowledgebase-pgvector-rerank
      nextNodeName: ["chain-node"]
    - name: chain-node
      displayName: "RetrievalQA chain"
      description: "chainæ˜¯langchainçš„æ ¸å¿ƒæ¦‚å¿µï¼ŒRetrievalQAChainç”¨äºä» retriever ä¸­æå–ä¿¡æ¯ï¼Œä¾›llmè°ƒç”¨"
      ref:
        apiGroup: chain.arcadia.kubeagi.k8s.com.cn
        kind: RetrievalQAChain
        name: base-chat-with-knowledgebase
      nextNodeName: ["Output"]
    - name: Output
      displayName: "æœ€ç»ˆè¾“å‡º"
      description: "æœ€ç»ˆè¾“å‡ºèŠ‚ç‚¹ï¼Œå¿…é¡»"
      ref:
        kind: Output
        name: Output
---
apiVersion: retriever.arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: KnowledgeBaseRetriever
metadata:
  name: base-chat-with-knowledgebase-pgvector-1
  namespace: arcadia
  annotations:
    arcadia.kubeagi.k8s.com.cn/input-rules: '[{"kind":"KnowledgeBase","group":"arcadia.kubeagi.k8s.com.cn","length":1}]'
    arcadia.kubeagi.k8s.com.cn/output-rules: '[{"kind":"RetrievalQAChain","group":"chain.arcadia.kubeagi.k8s.com.cn","length":1}]'
spec:
  displayName: "ä»çŸ¥è¯†åº“è·å–ä¿¡æ¯çš„Retriever"
  scoreThreshold: 0.3
  numDocuments: 50
---
apiVersion: retriever.arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: RerankRetriever
metadata:
  name: base-chat-with-knowledgebase-pgvector-rerank
  namespace: arcadia
  annotations:
    arcadia.kubeagi.k8s.com.cn/input-rules: '[{"kind":"KnowledgeBase","group":"arcadia.kubeagi.k8s.com.cn","length":1}]'
    arcadia.kubeagi.k8s.com.cn/output-rules: '[{"kind":"RetrievalQAChain","group":"chain.arcadia.kubeagi.k8s.com.cn","length":1}]'
spec:
  displayName: "rerank Retriever"
  scoreThreshold: 0.1
  numDocuments: 3
  model:
    kind: "Model"
    name: bce-reranker
    namespace: arcadia
