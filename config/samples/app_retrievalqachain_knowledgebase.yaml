apiVersion: arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: Application
metadata:
  name: base-chat-with-knowledgebase
  namespace: arcadia
spec:
  displayName: "çŸ¥è¯†åº“åº”ç”¨"
  description: "æœ€ç®€å•çš„å’ŒçŸ¥è¯†åº“å¯¹è¯çš„åº”ç”¨"
  prologue: "Welcome to talk to the KnowledgeBase!ğŸ¤–"
  nodes:
    - name: Input
      displayName: "ç”¨æˆ·è¾“å…¥"
      description: "ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹ï¼Œå¿…é¡»"
      ref:
        kind: Input
        name: Input
      nextNodeName: ["prompt-node"]
    - name: prompt-node
      displayName: "prompt"
      description: "è®¾å®špromptï¼Œtemplateä¸­å¯ä»¥ä½¿ç”¨{{xx}}æ¥æ›¿æ¢å˜é‡"
      ref:
        apiGroup: prompt.arcadia.kubeagi.k8s.com.cn
        kind: Prompt
        name: base-chat-with-knowledgebase
      nextNodeName: ["chain-node"]
    - name: retriever-node
      displayName: "ä»çŸ¥è¯†åº“æå–ä¿¡æ¯çš„retriever"
      description: "è¿æ¥åº”ç”¨å’ŒçŸ¥è¯†åº“"
      ref:
        apiGroup: retriever.arcadia.kubeagi.k8s.com.cn
        kind: KnowledgeBaseRetriever
        name: base-chat-with-knowledgebase
      nextNodeName: ["chain-node"]
    - name: chain-node
      displayName: "RetrievalQA chain"
      description: "chainæ˜¯langchainçš„æ ¸å¿ƒæ¦‚å¿µï¼ŒRetrievalQAChainç”¨äºä» retriever ä¸­æå–ä¿¡æ¯ï¼Œä¾›llmè°ƒç”¨"
      ref:
        apiGroup: chain.arcadia.kubeagi.k8s.com.cn
        kind: RetrievalQAChain
        name: base-chat-with-knowledgebase
      nextNodeName: ["Output"]
    - name: Output
      displayName: "æœ€ç»ˆè¾“å‡º"
      description: "æœ€ç»ˆè¾“å‡ºèŠ‚ç‚¹ï¼Œå¿…é¡»"
      ref:
        kind: Output
        name: Output
---
apiVersion: prompt.arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: Prompt
metadata:
  name: base-chat-with-knowledgebase
  namespace: arcadia
  annotations:
    arcadia.kubeagi.k8s.com.cn/input-rules: '[{"kind":"Input","length":1}]'
    arcadia.kubeagi.k8s.com.cn/output-rules: '[{"length":1}]'
spec:
  displayName: "è®¾å®šçŸ¥è¯†åº“åº”ç”¨çš„prompt"
  description: "è®¾å®šçŸ¥è¯†åº“åº”ç”¨çš„prompt, æ¥è‡ª https://github.com/tmc/langchaingo/blob/af36340149bbf35ae51c80357fa80bf648c33512/chains/question_answering.go#L9"
  userMessage: |
    Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.  
    
    {{.context}}
    
    Question: {{.question}}
    
    Helpful Answer:
---
apiVersion: chain.arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: RetrievalQAChain
metadata:
  name: base-chat-with-knowledgebase
  namespace: arcadia
  annotations:
    arcadia.kubeagi.k8s.com.cn/input-rules: '[{"kind":"LLM","group":"arcadia.kubeagi.k8s.com.cn","length":1},{"kind":"prompt","group":"prompt.arcadia.kubeagi.k8s.com.cn","length":1},{"group":"retriever.arcadia.kubeagi.k8s.com.cn","length":1}]'
    arcadia.kubeagi.k8s.com.cn/output-rules: '[{"kind":"Output","length":1}]'
spec:
  displayName: "RetrievalQAChain"
  description: "ç”¨äºæœç´¢QAçš„Chain"
  memory:
    maxTokenLimit: 20480
---
apiVersion: retriever.arcadia.kubeagi.k8s.com.cn/v1alpha1
kind: KnowledgeBaseRetriever
metadata:
  name: base-chat-with-knowledgebase
  namespace: arcadia
  annotations:
    arcadia.kubeagi.k8s.com.cn/input-rules: '[{"kind":"KnowledgeBase","group":"arcadia.kubeagi.k8s.com.cn","length":1}]'
    arcadia.kubeagi.k8s.com.cn/output-rules: '[{"kind":"RetrievalQAChain","group":"chain.arcadia.kubeagi.k8s.com.cn","length":1}]'
spec:
  displayName: "ä»çŸ¥è¯†åº“è·å–ä¿¡æ¯çš„Retriever"
  konwledgebase:
    name: ""
